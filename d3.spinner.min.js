(function(){d3.spinner=function(e){var t=this;this.current=0;this.stepsData=[];this.lineFunction=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear");this.initialize=function(e){if(!e)throw"d3.spinner needs at least a reference to an element||svg||g";if(!e.element&&!e.svg&&!e.g)throw"d3.spinner needs a reference to an element||svg||g";this.defaults={height:50,width:50,steps:15,inner_radius:.7,tail:!0,time:100,element:!1,svg:!1,g:!1,radius:0,cls:"spinner-step"};this.config=d3.tools.extend(this.defaults,e);this.config.radius=this.config.height>this.config.width?this.config.width:this.config.height;this.render();this.interval=setInterval(function(){t.update()},this.config.time)};this.render=function(){if(!this.config.svg&&!this.config.g){this.svg=this.config.element.append("svg").attr("class","spinner").attr("width",this.config.width).attr("height",this.config.height);this.g=this.svg.append("g")}else this.config.g?this.g=this.config.g:this.g=this.config.svg.append("g");var e=360/(this.config.steps*2)/180*Math.PI;for(var t=0;t<this.config.steps;t++){var n=[{x:this.config.width/2+d3.tools.polarToCartesian(e*t*2,this.config.radius/2*this.config.inner_radius)[0],y:this.config.height/2+d3.tools.polarToCartesian(e*t*2,this.config.radius/2*this.config.inner_radius)[1]},{x:this.config.width/2+d3.tools.polarToCartesian(e*t*2,this.config.radius/2)[0],y:this.config.height/2+d3.tools.polarToCartesian(e*t*2,this.config.radius/2)[1]},{x:this.config.width/2+d3.tools.polarToCartesian(e*(t*2+1),this.config.radius/2)[0],y:this.config.height/2+d3.tools.polarToCartesian(e*(t*2+1),this.config.radius/2)[1]},{x:this.config.width/2+d3.tools.polarToCartesian(e*(t*2+1),this.config.radius/2*this.config.inner_radius)[0],y:this.config.height/2+d3.tools.polarToCartesian(e*(t*2+1),this.config.radius/2*this.config.inner_radius)[1]},{x:this.config.width/2+d3.tools.polarToCartesian(e*t*2,this.config.radius/2*this.config.inner_radius)[0],y:this.config.height/2+d3.tools.polarToCartesian(e*t*2,this.config.radius/2*this.config.inner_radius)[1]}];this.stepsData[t]=this.g.append("path").attr("id","step_"+t).attr("class",this.config.cls).attr("d",this.lineFunction(n))}};this.update=function(){for(var e=0;e<this.config.steps;e++)e!=this.current?d3.select("#step_"+e).attr("class",this.config.cls):d3.tools.addClass(d3.select("#step_"+e),"active");if(this.config.tail)for(var e=1;e<5;e++){var t=this.current-e;t<0&&(t+=this.config.steps);d3.tools.addClass(d3.select("#step_"+t),"active-"+e)}this.current++;this.current>=this.config.steps&&(this.current=0)};this.destroy=function(){clearInterval(this.interval)};this.initialize(e)}})();